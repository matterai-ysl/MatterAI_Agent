# MatterAI Agent 工具添加流程文档

本文档详细说明如何为MatterAI Agent添加新的预设工具，包括前端后端的修改步骤以及国际化支持。

## 概述

MatterAI Agent支持两种类型的工具：
1. **预设工具** - 系统预定义的常用工具，支持中英文切换
2. **自定义工具** - 用户可以动态添加的MCP工具

本文档主要介绍如何添加预设工具。

## 架构说明

### 后端架构
- **工具配置**: `src/backend/Config.py`
- **智能体配置**: 支持多智能体，每个智能体可以有不同的工具集
- **MCP集成**: 通过HTTP协议与外部工具服务通信

### 前端架构
- **工具类型定义**: `src/frontend/src/types/tools.ts`
- **工具选择器**: `src/frontend/src/components/tools/ToolSelector.tsx`
- **国际化支持**: `src/frontend/src/i18n/locales/`

## 完整添加流程

### 1. 后端配置修改

#### 1.1 编辑 `src/backend/Config.py`

根据需要为MatterAI或MINDS智能体添加新工具：

**为MatterAI默认智能体添加工具：**
```python
# 预设工具配置
PRESET_TOOLS_CONFIG = {
    # 现有工具...
    
    "preset-新工具名称": {
        "name": "工具显示名称",
        "type": "mcp",
        "url": "http://127.0.0.1:端口号/mcp",
        "transport": "http"
    },
}
```

**为MINDS智能体添加工具：**
```python
# MINDS 智能体专用工具配置
MINDS_TOOLS_CONFIG = {
    # 现有工具...
    
    "preset-新工具名称": {
        "name": "工具显示名称",
        "type": "mcp",
        "url": "http://127.0.0.1:端口号/mcp",
        "transport": "http"
    },
}
```

**配置要求：**
- 工具ID必须以 `preset-` 开头
- URL需要指向实际运行的MCP工具服务
- 端口号需要与MCP工具服务一致
- transport通常使用 "http"

### 2. 前端类型定义修改

#### 2.1 编辑 `src/frontend/src/types/tools.ts`

**添加新的工具类型：**
```typescript
export type PresetToolType = 'material-knowledge' | 'xgboost' | 'material-extraction' | 
  'neural-network' | 'random-forest' | 'support-vector-machine' | '新工具类型';
```

**添加翻译键映射：**
```typescript
export const PRESET_TOOL_TRANSLATION_KEYS: Record<PresetToolType, string> = {
  // 现有映射...
  '新工具类型': '翻译键名称',
};
```

**添加工具配置：**
```typescript
export const PRESET_TOOLS: Omit<PresetTool, 'id' | 'enabled' | 'name' | 'description'>[] = [
  // 现有工具...
  {
    type: 'preset',
    toolType: '新工具类型',
    icon: '🎯', // 选择合适的emoji图标
  },
];
```

### 3. 国际化翻译添加

#### 3.1 编辑中文翻译 `src/frontend/src/i18n/locales/zh.json`

```json
{
  "tools": {
    // 现有翻译...
    "preset": {
      // 现有工具翻译...
      "翻译键名称": {
        "name": "工具中文名称",
        "description": "工具中文描述"
      }
    }
  }
}
```

#### 3.2 编辑英文翻译 `src/frontend/src/i18n/locales/en.json`

```json
{
  "tools": {
    // existing translations...
    "preset": {
      // existing tool translations...
      "翻译键名称": {
        "name": "Tool English Name",
        "description": "Tool English description"
      }
    }
  }
}
```

#### 3.3 更新工具选择器组件

在 `src/frontend/src/components/tools/ToolSelector.tsx` 中确保导入翻译键映射：

```typescript
import { PRESET_TOOL_TRANSLATION_KEYS } from '../../types/tools';

// 在生成预设工具实例时使用国际化
const presetTools: PresetTool[] = PRESET_TOOLS.map((tool, index) => {
  const translationKey = PRESET_TOOL_TRANSLATION_KEYS[tool.toolType];
  return {
    ...tool,
    id: `preset-${tool.toolType}`,
    name: t(`tools.preset.${translationKey}.name`),
    description: t(`tools.preset.${translationKey}.description`),
    enabled: selectedTools.includes(`preset-${tool.toolType}`)
  };
});
```

### 4. MCP工具服务要求

每个新工具都需要有对应的MCP工具服务：

#### 4.1 服务规范
- 必须实现MCP (Material Characterization Protocol) 协议
- 提供HTTP接口在指定端口
- 支持标准的MCP消息格式
- 处理工具调用和返回结果

#### 4.2 服务示例结构
```
工具服务目录/
├── server.py          # MCP服务器实现
├── tools/             # 工具逻辑实现
│   └── tool_logic.py
├── requirements.txt   # 依赖
└── README.md         # 服务说明
```

### 5. 部署和测试

#### 5.1 启动MCP工具服务
```bash
cd 工具服务目录
python server.py
```

#### 5.2 重启MatterAI服务
```bash
# 重启后端
cd src/backend
python main.py

# 重启前端（如果需要）
cd src/frontend
npm start
```

#### 5.3 测试验证
1. 在前端工具选择器中查看新工具是否显示
2. 测试中英文切换是否正常
3. 选择工具并发送消息，验证工具调用
4. 检查工具执行结果和报告生成

## 国际化最佳实践

### 翻译键命名规范
- 使用驼峰命名法：`materialKnowledge`, `neuralNetwork`
- 保持一致的命名风格
- 避免使用特殊字符或空格

### 描述文本建议
- **中文描述**：简洁明了，突出工具核心功能
- **英文描述**：使用标准术语，保持专业性
- **长度控制**：描述文本不宜过长，建议1-2句话

### 图标选择指南
- 选择与工具功能相关的emoji
- 保持视觉一致性
- 常用图标参考：
  - 🧪 化学/材料相关
  - 🤖 机器学习
  - 📊 数据分析
  - 🧠 神经网络/AI
  - 🌲 算法/森林
  - ⚖️ 平衡/分类
  - 📚 文献/知识

## 故障排除

### 常见问题及解决方案

#### 1. 工具不显示
**可能原因：**
- TypeScript类型定义错误
- 翻译文件格式错误
- 编译错误

**解决方案：**
- 检查类型定义语法
- 验证JSON格式正确性
- 查看浏览器控制台错误信息

#### 2. 工具调用失败
**可能原因：**
- MCP服务未启动
- 端口配置错误
- 服务实现不正确

**解决方案：**
- 确认MCP服务正在运行
- 检查端口号配置
- 验证服务实现符合MCP协议

#### 3. 翻译不生效
**可能原因：**
- 翻译键不匹配
- i18n配置问题
- 缓存问题

**解决方案：**
- 检查翻译键拼写
- 重启前端服务
- 清除浏览器缓存

### 调试技巧

#### 前端调试
```javascript
// 在浏览器控制台查看当前语言
console.log(i18n.language);

// 查看翻译资源
console.log(i18n.store.data);
```

#### 后端调试
```python
# 在Config.py中添加日志
import logging
logging.info(f"Loaded tools: {list(PRESET_TOOLS_CONFIG.keys())}")
```

## 维护和更新

### 版本兼容性
- 新工具添加通常向后兼容
- 注意保持配置文件格式一致性
- 更新后需要重启服务

### 文档更新
- 及时更新CLAUDE.md中的工具列表
- 更新API文档（如果有）
- 更新用户使用指南

### 测试清单
- [ ] 后端配置正确
- [ ] 前端类型定义完整
- [ ] 中英文翻译齐全
- [ ] MCP服务正常运行
- [ ] 工具选择器显示正常
- [ ] 语言切换功能正常
- [ ] 工具调用和结果返回正常
- [ ] 错误处理正确

## 示例：添加支持中英文切换的工具

以下是添加完整国际化支持工具的示例：

### 后端配置
```python
"preset-literature-extraction": {
    "name": "文献数据抽取",
    "type": "mcp",
    "url": "http://127.0.0.1:8004/mcp",
    "transport": "http"
},
```

### 前端类型定义
```typescript
export type PresetToolType = '...' | 'literature-extraction';

export const PRESET_TOOL_TRANSLATION_KEYS: Record<PresetToolType, string> = {
    'literature-extraction': 'literatureExtraction',
};

export const PRESET_TOOLS = [
    {
        type: 'preset',
        toolType: 'literature-extraction',
        icon: '📚',
    },
];
```

### 中文翻译
```json
"tools": {
  "preset": {
    "literatureExtraction": {
      "name": "文献数据抽取",
      "description": "从科学文献中提取关键数据和信息"
    }
  }
}
```

### 英文翻译
```json
"tools": {
  "preset": {
    "literatureExtraction": {
      "name": "Literature Data Extraction",
      "description": "Extract key data and information from scientific literature"
    }
  }
}
```

## 总结

通过遵循本文档的步骤，可以系统性地为MatterAI Agent添加新的预设工具，确保：
1. 前后端完整集成
2. 支持中英文切换
3. 符合系统架构规范
4. 便于维护和扩展

在添加新工具时，请确保每个步骤都得到正确执行，并进行充分的测试验证。